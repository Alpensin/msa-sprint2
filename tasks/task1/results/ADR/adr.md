### <a name="_b7urdng99y53"></a>**Название задачи: Проработка миграции от монолита к микросервисам**
### <a name="_hjk0fkfyohdk"></a>**Автор:  МА**
### <a name="_uanumrh8zrui"></a>**Дата: 10.11.2025**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Пользователь, Сервис пользователей|Проверка пользователя|1. Пользователь запрашивает свой статус<br>2. Система возвращает информацию о пользователе|
|2|Пользователь, Сервис отелей|Выбор отелей|1. Пользователь запрашивает список отелей по городу и/или рейтингу<br>2. Система возвращает информацию об отелях|
|3|Пользователь, Сервис отелей|Просмотр информации об отеле|1. Пользователь выбирает конкретный отель<br>2. Система возвращает информацию об отеле|
|4|Пользователь, Сервис отзывов|Просмотр отзывов по отелю|1. Пользователь запрашивает отзывы по отелю <br>2. Система возвращает отзывы по отелю|
|5|Пользователь, Сервис пользователей, Сервис отелей, Сервис промокодов, Сервис бронирования|Создание бронирования|1. Пользователь передает id пользователя, id отеля, промокод (опционально)<br>2. Проверяется активность пользователя<br>3. Проверяется доступность отеля и его рейтинг<br>4. Рассчет базовой стоимости для пользователя<br>Рассчет итоговой стоимости с дисконтом<br>5. Система создает бронирование|
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|**№**|**Требование**|
| :-: | :- |
|1|Поддерживаемость: Разделение ответственности между компонентами для упрощения разработки и тестирования|
|2|Масштабируемость: Система должна поддерживать горизонтальное масштабирование|
|3|Производительность: Время отклика API должно быть минимально для операций бронирования, поиска отелей|
|4|Надежность: Система должна обеспечивать высокую доступность для основных функций бронирования|
### <a name="_qmphm5d6rvi3"></a>**Решение**

В текущей архитектуре выделены 5 сервисов.
Их разделение соответствует границам контекстов и можно выделить аналогичные микросервисы.
Потребуется отказ от синхронного взаимодействия между всеми сервисами в сторону асинхронного.
Все сервисы будут под большим количеством запросов.
При этом наиболее сложная логика в сервисе букинга, т.к. он завязан на другие сервисы.
Потребуется уменьшить или облегчить количество походов в другие сервисы и сделать процесс букинга асинхронным.
Наименее загруженным сервисом должен быть сервис промокодов.

#### Основное решение
1. Введение BFF для фронтенда, чтобы упростить работу на фронтенде и иметь более гибкую возможность для перестраивания системы.
2. Разделение монолита на 5 микросервисов. Сервисы монолита становятся отдельными микросервисами.
3. Бронирование постепенно переходит на работу в асинхронном режиме. Пользователю сразу сообщается о создании заявки на бронирование. Дальше асинхронно заявка меняет статус. Это позволит лучше масштабировать систему и снизит вероятность отказов.
4. Микросервисы взаимодействуют друг с другом по gRPC. Это более производительно, чем по REST.

Начать рекомендуется с сервиса бронирования. Этот сервис самый загруженный, для него ожидается переход в асинхронный режим работы в дальнейшем.
Вынос его в микросервис позволит начать получать преимущества от микросервисного подхода.
Далее пойдут сервис Пользователей, Отелей, сервис отзывов, и в завершение сервис промо.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Альтернативным решением является полный переход на асинхронное взаимодействие. Сервисы передают события в брокер, а каждый сервис подписывается на нужные им события. Возможно сохранение нужной информации у себя в локальной базе данных. 
Подход Event Sourcing.

**Недостатки, ограничения, риски**
##### Риски перехода в микросервисы
1. Сложность внедрения. Потребует увеличения сложности инфраструктуры и ее поддержки
2. Более высокие навыки оманды и дисциплина разработки
3. Отказ от ACID в сторону eventually consistensy
4. Вместо внутрипроцессного взаимодействия переход на сетевое взаимодействие. Могут вырасти сетевые задержки.

##### Сравнение основного и альтернативного подходов
1. Основной подход более постепенный. Позволит быстрее перейти к новому решению.
2. Альтернативный подход меняет парадигму взаимодейтсвия и команде потребуется адаптироваться к такому решению.
3. Основной подход требует большого количества запросов в разные сервисы от сервиса бронирования. Это увеличит время обработки запросов. Это компенсируется переходом в асинхронный режим
4. Полностью асинронный режим работы будет сложнее дебажить и тестировать.

По перечисленным причинам решено начать с основного подхода для более плавного перехода.